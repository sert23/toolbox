{% extends "base.html" %}
{% load staticfiles %}
{% load render_table from django_tables2 %}

{% block header %}
    <script src="{% static 'js/plotly-latest.min.js' %}"></script>
{% endblock %}

{% block content %}

    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h3 class="page-header">miRNAgFree Results for job ID: <a href="{{ settings.SUB_SITE }}/jobstatus/{{ id }}" class="alert-link">{{ id }}</a> </h3>

            </div>
            <!-- /.col-lg-12 -->
            <div class="col-lg-8">

                <p class="text-danger">The results will be stored for 15 days (This will be removed on:  {{ date|date:"D d M Y" }}).</p>

{#                <p class="text-primary">If you use the sRNAbench webserver plese check <a href="#" data-toggle="modal" data-target="#HWTC_bench" >How to Cite.</a></p>#}

                {% if running %}
                    <p class="text-warning">This job is still running. The page will be automatically refreshed each 60s</p>
                {% endif %}
            </div>
        </div>
        <!-- /.row -->
        <div class="row">

            <!-- Nav tabs -->
    <div class="row">



                    {% if zip %}
<div class="col-lg-12">
                <h4 class="text-success"> Download all results as zip file <a href="{{ MEDIA_URL }}{{ zip }}" download> <i class="fa fa-file-zip-o fa-fw"></i> here</a></h4>
</div>
                {% endif %}
        {% if parameters %}
            <div class="col-lg-6">
            <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" href="#Parameters" >Parameters</a>
                </h4>
            </div>
            <!-- .panel-heading -->
            <div id="Parameters" class="panel-collapse collapse">
                <div class="panel-body">


                    <div class="col-lg-10">
                        <pre style="white-space: pre-line">

                    {{ parameters }}
                        </pre>
                    </div>

                </div>
            </div>
            </div>
            </div>
        {% endif %}
        </div>

            <ul class="nav nav-pills" id="myTab">


                <li class="active"><a href="#Summary" data-toggle="tab">Summary</a>
                </li>

                <li ><a href="#explore" data-toggle="tab">Explore predictions</a>
                </li>

                <li ><a href="#expression" data-toggle="tab">Expression levels</a>
                </li>
                <li ><a href="#plots" data-toggle="tab">Graphs</a>
                </li>

{#                {% if preproc %}#}
{#                <li class="active" ><a href="#Preprocessing" data-toggle="tab">Preprocessing</a>#}
{#                </li>#}
{#                {% endif %}#}

            </ul>



            <!-- Tab panes -->
        <br>
        <br>
            <div class="tab-content">


                <div class="tab-pane fade in active" id="Summary">

                    <div class="col-lg-10">
                        <pre style="white-space: pre-line">

                        {{ summary_content }}
                        </pre>
                    </div>


                </div>


            <div class="tab-pane fade" id="explore">

                    <div class="col-lg-3">

                      <label>  Choose a prediction  <a data-toggle="modal" data-target="#naming_info" class="btn btn-link"><i class="fa fa-question-circle"> </i></a></label> <div class="controls">
                     <select name="choose_predictions" id="id_choose_predictions" class="selectmultiple">
                        <option value="" disabled selected> </option>
                         {% for  name in prediction_list %}
{#                         <option value="{{ value }}">{{ name }}</option>#}
                         <option value="{{ name }}">{{ name }}</option>
                         {% endfor %}

                     </select>
                    <input type="hidden" name='choose_predictions_hidden' id='id_choose_predictions_hidden'/>
                    </div>


                </div>

            <div class="col-lg-1">
            </div>
            <div class="col-lg-7" id="explore_div">
               <label>   Sequence: </label>
                <pre id="seq_pre">  </pre>
                <label>   Alignment pile: </label>
{#                <pre>#}
{#                    <b>TTGAGACTCTGAAATCTGATT	6</b>#}
{#                       TTGAGACTCTGGGTCTGAGTGAA	1#}
{#                       GTGAGACTCCTCTTGCTCG	1#}
{#                       CTGAGACTTGAACTTGGGG	1#}
{#                        </pre>#}
                <pre id="pile_pre" ></pre>
            </div>





            </div>

            <div class="tab-pane fade" id="expression">

                    <div class="col-lg-10">
                    <table id="exp_table" class="table table-striped table-bordered table-hover dataTable no-footer"></table>
                    </div>


                </div>




            <div class="tab-pane fade" id="plots">

                    <div class="col-lg-10">
                        <button class="btn btn-success mr-2" onclick="$('#mirg_plot').modal('show');"> Expression barplots </button>
                        <button class="btn btn-success" onclick="$('#HEHE').modal('show');"> Expression distribution </button>
                    </div>




                </div>

{#            <div class="tab-pane fade" id="expression">#}
{#                <pre>HELO</pre>#}
{#            </div>#}
            </div>
    </div>

{% endblock %}

{% block modals %}
    {% include "Messages/bench/HWTCbench.html" %}
    {% include "Messages/miRgFree/candidate_naming.html" %}
    {% include "Messages/miRgFree/graph.html" %}
    {% include "Messages/miRgFree/piled_graph.html" %}
{% endblock %}

{% block js %}

    <script src="{% static 'js/plugins/dataTables/jquery.dataTables.js' %}"></script>
    <script src="{% static 'js/plugins/dataTables/dataTables.bootstrap.js' %}"></script>


    <script>
        $('#explore_div').hide();
    </script>

    <script>

        $('#id_choose_predictions').change(function(){

            $.ajax({
                url: '{% url "pile" %}',
                data: {
                    "id" : "{{ id }}",
                    "name": $('#id_choose_predictions').val(),
                },
                dataType: 'json',
                success: function (data) {

                    {#alert(data.pile);#}

                    $('#pile_pre').html(data.pile);
                    $('#seq_pre').html(data.seq);
                    $('#explore_div').show();

                },
            });

    });


    </script>


    <script>

    var received_data = {{ exp_body|safe }};
    var received_cols = {{ exp_headers|safe }}

    $(document).ready(function() {

        var table = $('#exp_table').DataTable({

//        'responsive': true,
            "aaSorting": [[2,'desc']],
            data: received_data,
//        processing: true,
//        serverSide: true,
//        deferRender: false,
            'language': {
                "loadingRecords": "&nbsp;",
                "processing": "Loading..."
            },
            columns: received_cols,
        });

    });

    </script>



    <script>



        $(document).ready(function() {
            if(location.hash) {
                $('a[href=' + location.hash + ']').tab('show');
            }
            $(document.body).on("click", "a[data-toggle]", function(event) {
                location.hash = this.getAttribute("href");
            });
        });
        $(window).on('popstate', function() {
            var anchor = location.hash || $("a[data-toggle=tab]").first().attr("href");
            $('a[href=' + anchor + ']').tab('show');
        });
    </script>

    {% if running %}

    <script type="text/javascript">

        function ReloadPage() {
            location.reload();
        }

        $(document).ready(function() {
            setTimeout("ReloadPage()", 60000);
        });
    </script>


    {% endif %}




{% endblock %}

</br> </br> </br>