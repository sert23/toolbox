{#{% extends 'base.html' %}#}
{#{% extends 'photos/base.html' %}#}
{% extends "base.html" %}
{% load staticfiles %}

{% block content %}

{#{% load static %}#}

<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">


{% block modals %}
    {% include "Messages/bench/Choose_input.html" %}
    {% include "Messages/bench/sRNAbenchInput.html" %}
    {% include "Messages/bench/Species_dropdown.html" %}
    {% include "Messages/bench/library_mode.html" %}
    {% include "Messages/bench/other_ncrnas.html" %}
    {% include "Messages/bench/guess_Adapter.html" %}
    {% include "Messages/bench/minimum_adapter_length.html" %}
    {% include "Messages/bench/mismatches_adapter.html" %}
    {% include "Messages/bench/quality_filter.html" %}
    {% include "Messages/bench/phred_encode.html" %}
    {% include "Messages/bench/mirna_species.html" %}
    {% include "Messages/bench/Not_profile.html" %}
    {% include "Messages/bench/RecursiveAdaptorTrimming.html" %}
    {% include "Messages/bench/speciesBench.html" %}
    {% include "Messages/bench/UploadUserFiles.html" %}
    {% include "Messages/bench/mirnas.html" %}

{#    Protocols      #}
    {% include "Messages/protocols/Illumina.html" %}
    {% include "Messages/protocols/NEB.html" %}
    {% include "Messages/protocols/Bioo.html" %}
    {% include "Messages/protocols/Smarter.html" %}
    {% include "Messages/protocols/Qiagen.html" %}
    {% include "Messages/protocols/Custom.html" %}
    {% include "Messages/protocols/Guess.html" %}


{% endblock %}

    {% block javascript %}
{#    <script src="{% static 'js/jquery-3.1.1.min.js' %}"></script>#}
{#    <script src="{% static 'js/bootstrap.min.js' %}"></script>#}
  {# JQUERY FILE UPLOAD SCRIPTS #}
{#  <script src="{% static 'js/jquery-file-upload/vendor/jquery.ui.widget.js' %}"></script>#}
{#  <script src="{% static 'js/jquery-file-upload/jquery.iframe-transport.js' %}"></script>#}
{#  <script src="{% static 'js/jquery-file-upload/jquery.fileupload.js' %}"></script>#}
{##}
{#  <script src="/static/vendors/datatables.net/js/jquery.dataTables.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-buttons/js/dataTables.buttons.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-buttons/js/buttons.flash.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-buttons/js/buttons.html5.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-buttons/js/buttons.print.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-responsive/js/dataTables.responsive.min.js"></script>#}
{#  <script src="/static/vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js"></script>#}
{#  <script src="/static/vendors/datatables.net-scroller/js/dataTables.scroller.min.js"></script>#}
{##}
{#<script src="http://cdn.datatables.net/plug-ins/1.10.12/api/processing().js"></script>#}

        <script src="{% static 'js/jquery-file-upload/vendor/jquery.ui.widget.js' %}"></script>
  <script src="{% static 'js/jquery-file-upload/jquery.iframe-transport.js' %}"></script>
  <script src="{% static 'js/jquery-file-upload/jquery.fileupload.js' %}"></script>

  <script src="{% static 'vendors/datatables.net/js/jquery.dataTables.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-bs/js/dataTables.bootstrap.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-buttons/js/dataTables.buttons.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-buttons-bs/js/buttons.bootstrap.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-buttons/js/buttons.flash.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-buttons/js/buttons.html5.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-buttons/js/buttons.print.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-fixedheader/js/dataTables.fixedHeader.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-keytable/js/dataTables.keyTable.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-responsive/js/dataTables.responsive.min.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-responsive-bs/js/responsive.bootstrap.js'%} "></script>
  <script src="{% static 'vendors/datatables.net-scroller/js/dataTables.scroller.min.js'%} "></script>

<script src="http://cdn.datatables.net/plug-ins/1.10.12/api/processing().js'%} "></script>
<style>

    .help-block{
   color: #dc465b;
   font-style: italic;
}

</style>

{% endblock %}

{% block js %}


    <script>

    var toggleDB = function(DB) {

        {#div_list = ["MGDB_div", "MB_div", "PM_div" ];#}

        $("#MGDB_div").css("display", "none");
        $("#MB_div").css("display", "none");
        $("#PM_div").css("display", "none");


        if (DB) {
            if (DB == "1") {
                $("#MB_div").css("display", "block");
            } else if (DB == "2") {
                $("#MGDB_div").css("display", "block");
            } else if (DB == "3") {
                $("#PM_div").css("display", "block");

            }
        }
    };

    $("#id_reference_database").change(function() {

        toggleDB($("#id_reference_database").val());

    });

    {# hide DB selectors on start #}
    toggleDB($("#id_reference_database").val());

    </script>


    <script>
        jQuery(document).ready(function() {
            jQuery('.db-multi').multiselect({
                enableCollapsibleOptGroups: true,
                enableCaseInsensitiveFiltering: true,
                filterBehavior: 'both',
                maxHeight: 300,
                onDropdownHidden: function (e) {
                  {# alert($("#id_mirgeneDB").val());#}
                },
            })
        });
    </script>


    <script>

function toggleFields() {
{#    if ($("#age").val() <= 13)#}
    if ( document.getElementById('id_species_hidden').value){

        $("#genome-div").show();
    }else{
        $("#genome-div").hide();
    }}


$('input[name="library_protocol"]').on("click", function(e) {
    if (document.getElementById('id_library_protocol_10').checked) {
        $("#Adapter_Custom").show();
    } else {
        $("#Adapter_Custom").hide();
    }
})



$("#id_quality_method").change(function () {
{#    if ( document.getElementById('id_library_protocol_6').checked){#}
    if ( document.getElementById('id_quality_method').value === "min"){
        $("#Div_max").show();
    }else{
        $("#Div_max").hide();
    }
    });


        {##}
        {# Adapter options #}
        {##}

$('input[name="guess_adapter"]').on("click", function(e) {
    if ( document.getElementById('id_guess_adapter').checked){
        document.getElementById("id_adapter_chosen").disabled = true;
        document.getElementById("id_adapter_manual").disabled = true;
    }else{
        document.getElementById("id_adapter_chosen").disabled = false;
        document.getElementById("id_adapter_manual").disabled = false;
    }

})

$('input[name="adapter_manual"]').on("mouseout", function(e) {

    if ( document.getElementById('id_adapter_manual').value.length > 0 ){

        document.getElementById("id_adapter_chosen").disabled = true;
        document.getElementById("id_guess_adapter").disabled = true;
    }else{
        document.getElementById("id_adapter_chosen").disabled = false;
        document.getElementById("id_guess_adapter").disabled = false;
    }

})
$('input[name="adapter_manual"]').on("change", function(e) {

    if ( document.getElementById('id_adapter_manual').value.length > 0 ){

        document.getElementById("id_adapter_chosen").disabled = true;
        document.getElementById("id_guess_adapter").disabled = true;
    }else{
        document.getElementById("id_adapter_chosen").disabled = false;
        document.getElementById("id_guess_adapter").disabled = false;
    }

})

$("input[type=file]").on('change',function(){
    var extensions = ["xls","xlsx","doc","docx"]
    if (extensions.includes(this.files[0].name.split('.').pop()) ){
        alert('Spread-sheet or document extensions such as ".xls" or ".doc" are not supported. Please upload a different file. ')
        document.getElementById('id_ifile').value = "";
    }

{#    filename.split('.').pop();#}
});

function toggleAdapter() {
{#    if ($("#age").val() <= 13)#}
    if ( document.getElementById('id_library_protocol').value){

        $("#genome-div").show();
    }else{
        $("#genome-div").hide();
    }}





</script>

   <script>
    jQuery(document).ready(function() {
        jQuery('#id_species').multiselect({
            enableCollapsibleOptGroups: true,
            enableCaseInsensitiveFiltering: true,
            filterBehavior: 'both',
            maxHeight: 300,
            onDropdownHidden: function (e) {
                if(document.getElementById('id_species').value){
                   jQuery('#id_species_hidden').val(jQuery('#id_species').val().map(function(item) {
                        return item.split(':')[0]}).join(','));
                } else{
                        document.getElementById('id_species_hidden').value = "" ;
                }
{#                    alert(document.getElementById('id_species_hidden').value);#}
                    toggleFields();
{#                alert(jQuery('#id_species').val().join(','));#}

            }

        });
        if (selectedItems.length>0){
            document.getElementById("submit-id-submit").disabled = false;
        }else {
            document.getElementById("submit-id-submit").disabled = true;
        }
        if ( document.getElementById('id_species_hidden').value){
            $("#genome-div").show();
        }else{
            jQuery("#genome-div").hide();
        }
        if (document.getElementById('id_library_protocol_10').checked) {
            $("#Adapter_Custom").show();
        } else {
            $("#Adapter_Custom").hide();
        }
        if ( document.getElementById('id_quality_method').value === "min"){
            $("#Div_max").show();
        }else{
            $("#Div_max").hide();
        }
         });
    </script>


    <script>
    function validation() {
        var x, text, message;
        message = "There were some errors in your job. Please select your input again and check for invalid options"

        x = document.getElementById("id_adapter_manual").value;

        if (!document.getElementById("id_species").value && !document.getElementById("id_mirna_profiled").value) {
            document.getElementById('id_ifile').value = "";
            alert(message);
            return true
{#            alert("species and mirna_profiled" + document.getElementById("id_species").value); return true#}
        }else if ((0 + Boolean(document.getElementById('id_ifile').value) + Boolean(document.getElementById('id_url').value) + Boolean(document.getElementById('id_sra_input').value )!=1)){
            document.getElementById('id_ifile').value = "";
{#            alert("id_file url");#}
{#            return true;#}
            alert(message);
            return true
        }else if (document.getElementById('id_predict_mirna').checked && document.getElementById('id_library_mode').checked){
            document.getElementById('id_ifile').value = "";
{#            alert( " predict and library mode"); return true#}
            alert(message);
            return true
        }else if ((0 + document.getElementById('id_guess_adapter').checked + Boolean(document.getElementById('id_adapter_chosen').value) + Boolean(document.getElementById('id_adapter_manual').value )!=1)){
            document.getElementById('id_ifile').value = "";
{#            alert(message); return true#}
            alert("adapter row");
            return true
        }else if (document.getElementById('id_guess_adapter').checked && !document.getElementById('id_species')){
            document.getElementById('id_ifile').value = "";
            alert(message);
            return true
{#            alert("guess without species"); return true#}
        }
    }
    </script>

    <script>
    $('input[name="referenceDB"]').on("click", function(e) {
        x = document.getElementById("id_referenceDB_3").checked;
        if (x==false){
            document.getElementById("div_id_mirDB").style.visibility="hidden";
            document.getElementById("id_mirDB").style.visibility="hidden";
{#            document.getElementById("show-me-three").style.visibility="hidden";#}
        }
        else{
            document.getElementById("div_id_mirDB").style.visibility="visible";
            document.getElementById("id_mirDB").style.visibility="visible";
        }
{#    if (e.clientX === 0 && e.clientY === 0) {#}
{#        console.log("keyboard");#}
{#    } else {#}
{#        console.log("mouse");#}
{#    };#}
{#        alert(x)#}
});
    </script>

    <script>

        $(document).ready(function(){
            $("#button_div").attr("href","#");
            $("#button_div").attr("data-toggle","tooltip");
            $("#button_div").attr("style","display:inline-block");
            $("#button_div").attr("data-placement","right");
            $("#button_div").attr("data-original-title","");

            $('[data-toggle="tooltip"]').tooltip();
         });


{#    $('#submit-id-submit').on('mouseover', function () {#}
{#        if (document.getElementById("submit-id-submit").disabled){#}
{#            $("#button_div").attr("title","Please select at least one sample");#}
{#        }else{#}
{#            $("#button_div").attr("title","Please select at least one sample");#}
{#        }#}
{#    });#}




    var selectedItems=[];
    function printChecked(){
    $("input:checkbox[name=to_list]:checked").each(function() {
    selectedItems.push($(this).val());
    selectedItems=Array.from(new Set(selectedItems))
    });
    $("input:checkbox[name=to_list]:not(:checked)").each(function() {
    selectedItems=selectedItems.filter(e => e !== $(this).val());
    });
{#    alert(selectedItems);#}

    }
    function saveChecked() {
        $('#spinner').modal('show');
{#        validation()#}
        document.getElementById('id_input_hidden').value = selectedItems.join();
{#        alert(document.getElementById('id_input_hidden').value)#}
    }
</script>


{% endblock %}

{#    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>#}
{#      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>#}
{#    <script src="{% static 'js/jquery-3.1.1.min.js' %}"></script>#}
{#    <script src="{% static 'js/bootstrap.min.js' %}"></script>#}

<!-- Modal -->
<div class="modal fade" id="spinner" tabindex="-1" role="dialog" aria-labelledby="spinnerLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-body">
          <img style="display:block; margin-left:auto; margin-right:auto; width:50%;" src="{% static 'gif/Multibench_spinner.gif' %}">
        </div>
      </div>
    </div>
</div>

  {# PHOTOS PAGE SCRIPTS #}
{#  <script src="{% static 'photos/js/progress-bar-upload.js' %}"></script>#}

    <div id="page-wrapper">

        <div class="col-lg-12">
            <div class="page-header">
            <h3>Choose sRNAbench parameters for your files</h3>
            </div>
        </div>

        <div class="row">
        <div class="col-lg-9">

        <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" href="#collapseOne">Uploaded data</a>
            </h4>

        </div>
        <div id="collapseOne" class="panel-collapse collapse in">
            <div class="panel-body">
            <div style="margin-bottom: 20px;">


    {#            <table id="jobs" class="table table-striped table-bordered bulk_action"></table>#}

                <table id="jobs" class="table table-striped table-bordered table-hover dataTable no-footer"></table>
            </div>

                {% load crispy_forms_tags %}
                {% crispy form %}

            </div>

        </div>
        </div>
        </div>

            <div class="col-lg-3">
            <div class="panel panel-info">
            <div class="panel-heading">
                <h4 class="panel-title">
                    Help
                </h4>
            </div>
            <div class="panel-body">
                <a href="{{ settings.MANUAL_URL }}" target="_blank">Link to Web Manual</a>
{#                <a href="http://bioinfo5.ugr.es/sRNAbench/sRNAbench_web.pdf" target="_blank">Link to Web Manual</a>#}
{#                <br/>#}
{#                <a href="{{ settings.SUB_SITE }}/jobstatus/51GKXBGGWRXZ4QO" target="_blank">Link to Test Data Results</a>#}
                </div>

                </div>
    </div>

        <div class="col-lg-3">
            <div class="panel panel-success">
            <div class="panel-heading">
                <h4 class="panel-title">
                    Test Data Description
                </h4>
            </div>
            <div class="panel-body">
                Secreted exosomes and cell fraction of a lymphoblastoid cell line (LCLs). Small RNAs of human and virus origin can be detected.
                <br>
                <a href="http://www.cell.com/cell-reports/fulltext/S2211-1247%2814%2900703-7"  target="_blank">Link To Publication</a>
            </div>
            </div>

    </div>

    <div class="col-lg-3">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 class="panel-title">
                    Test Data Parameters
                </h4>
            </div>
            <div class="panel-body">
                Species: <pre style=" white-space: nowrap; overflow-y: hidden">Human(GRCh38_p10),Epstein Barr Virus(NC_007605)</pre>
                Protocol: Illumina


            </div>

        </div>
            </div>



</div>
    </div>


{#{% block photos_content %}#}

<script>
    var received_data = {{ table_data|safe }};
    var received_cols = {{ table_headers|safe }}

    $(document).ready(function() {

    var table = $('#jobs').DataTable( {

//        'responsive': true,
        data: received_data,
//        processing: true,
//        serverSide: true,
//        deferRender: false,
        'language':{
       "loadingRecords": "&nbsp;",
      "processing": "Loading..."
    },
        columns: received_cols,
    } );

    $('#jobs').on('click', 'tr', function () {
{#    $('#jobs tbody').on('click', 'tr', function () {#}
        var data = table.row( this ).data();
//        alert( 'You clicked on '+data[2]+'\'s row' );
        printChecked();
        if (selectedItems.length>0){
            document.getElementById("submit-id-submit").disabled = false;
            $("#button_div").attr("data-original-title","");
{#            $('#button_div').tooltip('disable')#}

        }else{
            document.getElementById("submit-id-submit").disabled = true;
            $("#button_div").attr("data-original-title","Please select at least one sample to proceed");
{#            $('[rel=tooltip]').tooltip('enable')#}
        }
    } );
    $("#flowcheckall").click(function () {
        //$('#flow-table tbody input[type="checkbox"]').prop('checked', this.checked);
        var cols = table.column(2).nodes(),
            state = this.checked;

        for (var i = 0; i < cols.length; i += 1) {
        	cols[i].querySelector("input[type='checkbox']").checked = state;

        	if (state) {
                selectedItems.push(cols[i].querySelector("input[type='checkbox']").value);
                            }else{
        	    selectedItems =[];
            }
{#        	alert(cols[i].querySelector("input[type='checkbox']").value)#}

        }
        {#alert(selectedItems.length)#}
{#        printChecked();#}
});

    var cols = table.column(2).nodes(),
            state = true;
        for (var i = 0; i < cols.length; i += 1) {
        	cols[i].querySelector("input[type='checkbox']").checked = state;

        	if (state) {
                selectedItems.push(cols[i].querySelector("input[type='checkbox']").value);
                            }
            }
{#        	alert(cols[i].querySelector("input[type='checkbox']").value)#}


} );





</script>


{% endblock %}

